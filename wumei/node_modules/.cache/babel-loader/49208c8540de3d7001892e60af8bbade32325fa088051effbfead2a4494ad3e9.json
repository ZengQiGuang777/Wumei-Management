{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.error.cause.js\";\nimport ut from '@/assets/utils';\nimport router from '@/router';\nexport default {\n  methods: {\n    //获取验证码\n    async queryCaptcha() {\n      this.captcha.isLoading = true;\n      try {\n        let {\n          code,\n          img,\n          uuid\n        } = await this.$API.queryCaptchaImage();\n        if (+code !== 200) {\n          this.$message.error('网络出现异常，请稍后再试');\n        } else {\n          this.captcha.img = `data:image/jpeg;base64,${img}`;\n          this.captcha.uuid = uuid;\n        }\n      } catch (err) {\n        console.log(err);\n      }\n      this.captcha.isLoading = false;\n    },\n    //登录校验\n    async submit() {\n      try {\n        //先进行表单校验\n        await this.$refs.formIns.validate();\n\n        //获取表单中的数据，向服务器发送请求\n        let {\n          username,\n          password,\n          code,\n          remeber\n        } = this.ruleForm;\n        let {\n          code: resultCode,\n          token,\n          msg\n        } = await this.$API.checkUserLogin({\n          username,\n          password,\n          code,\n          uuid: this.captcha.uuid\n        });\n        //登录失败\n        if (+resultCode !== 200) {\n          this.$message.error(msg);\n          return;\n        }\n        //登录成功\n        //首先设置token\n        ut.storage.set('TK', token);\n        await this.$store.dispatch('setProfileAsync');\n        if (remeber) {\n          ut.storage.set('REMBER', {\n            username,\n            password //真实开发一定要加密\n          });\n        } else {\n          ut.storage.remove('REMBER');\n        }\n        this.$message.success('铁汁，登录成功了');\n        this.$router.push('/home');\n      } catch (_) {\n        console.log({\n          _\n        });\n      }\n    }\n  },\n  /* 在创建的时候发一次请求 */\n  created() {\n    this.queryCaptcha();\n  },\n  data() {\n    // 校验密码的格式\n    const validatePassword = (_, value, callback) => {\n      // if (value === place) return callback()\n      if (value.length === 0) return callback(new Error('密码是必填项哦~'));\n      /* let reg = /^\\S*(?=\\S{6,})(?=\\S*\\d)(?=\\S*[A-Z])(?=\\S*[a-z])(?=\\S*[!@#$%^&*? ])\\S*$/\n      if (!reg.test(value)) return callback(new Error('密码格式有误~')) */\n      callback();\n    };\n    return {\n      captcha: {\n        isLoading: true,\n        img: '',\n        uuid: ''\n      },\n      ruleForm: {\n        username: '',\n        password: '',\n        code: '',\n        remeber: false\n      },\n      rules: {\n        username: [{\n          required: true,\n          message: '账号必须要填哦',\n          trigger: 'blur'\n        }],\n        password: [{\n          required: true,\n          validator: validatePassword,\n          trigger: 'blur'\n        }],\n        code: [{\n          required: true,\n          message: '验证码也必须要填铁汁',\n          trigger: 'blur'\n        }]\n      }\n    };\n  }\n};","map":{"version":3,"names":["ut","router","methods","queryCaptcha","captcha","isLoading","code","img","uuid","$API","queryCaptchaImage","$message","error","err","console","log","submit","$refs","formIns","validate","username","password","remeber","ruleForm","resultCode","token","msg","checkUserLogin","storage","set","$store","dispatch","remove","success","$router","push","_","created","data","validatePassword","value","callback","length","Error","rules","required","message","trigger","validator"],"sources":["src/views/users/logOn.vue"],"sourcesContent":["<script>\nimport ut from '@/assets/utils'\nimport router from '@/router';\nexport default {\n    methods: {\n        //获取验证码\n        async queryCaptcha() {\n            this.captcha.isLoading = true\n            try {\n                let { code, img, uuid } = await this.$API.queryCaptchaImage()\n                if (+code !== 200) {\n                    this.$message.error('网络出现异常，请稍后再试')\n                } else {\n                    this.captcha.img = `data:image/jpeg;base64,${img}`\n                    this.captcha.uuid = uuid\n                }\n            } catch (err) {\n                console.log(err);\n            }\n            this.captcha.isLoading = false\n        },\n        //登录校验\n        async submit() {\n            try {\n                //先进行表单校验\n                await this.$refs.formIns.validate()\n                \n                //获取表单中的数据，向服务器发送请求\n                let { username, password, code, remeber } = this.ruleForm\n                let { code: resultCode, token, msg } = await this.$API.checkUserLogin({\n                    username,\n                    password,\n                    code,\n                    uuid: this.captcha.uuid\n                })\n                //登录失败\n                if (+resultCode !== 200) {\n                    this.$message.error(msg)\n                    return\n                }\n                //登录成功\n                //首先设置token\n                ut.storage.set('TK', token)\n                await this.$store.dispatch('setProfileAsync')\n                if (remeber) {\n                    ut.storage.set('REMBER', {\n                        username,\n                        password,//真实开发一定要加密\n                    })\n                } else {\n                    ut.storage.remove('REMBER')\n                }\n                this.$message.success('铁汁，登录成功了')\n                this.$router.push('/home')\n            } catch (_) { \n                console.log({_})\n            }\n        }\n    },\n    /* 在创建的时候发一次请求 */\n    created() {\n        this.queryCaptcha()\n    },\n    data() {\n        // 校验密码的格式\n        const validatePassword = (_, value, callback) => {\n            // if (value === place) return callback()\n            if (value.length === 0) return callback(new Error('密码是必填项哦~'))\n            /* let reg = /^\\S*(?=\\S{6,})(?=\\S*\\d)(?=\\S*[A-Z])(?=\\S*[a-z])(?=\\S*[!@#$%^&*? ])\\S*$/\n            if (!reg.test(value)) return callback(new Error('密码格式有误~')) */\n            callback()\n        }\n        return {\n            captcha: {\n                isLoading: true,\n                img: '',\n                uuid: ''\n            },\n            ruleForm: {\n                username: '',\n                password: '',\n                code: '',\n                remeber: false\n            },\n            rules: {\n                username: [\n                    {\n                        required: true, message: '账号必须要填哦', trigger: 'blur'\n                    }\n                ],\n                password: [\n                    {\n                        required: true,\n                        validator: validatePassword, trigger: 'blur'\n                    }\n                ],\n                code: [\n                    {\n                        required: true, message: '验证码也必须要填铁汁', trigger: 'blur'\n                    }\n                ],\n            }\n\n        }\n    }\n}\n</script>\n\n<template>\n    <a-form-model id=\"container\" ref=\"formIns\" :model=\"ruleForm\" :rules=\"rules\">\n        <a-form-model-item prop=\"username\">\n            <a-input placeholder=\"用户名\" style=\"width: 320px;\" v-model=\"ruleForm.username\">\n                <a-icon slot=\"prefix\" type=\"user\" style=\"color: rgba(0,0,0,.25)\" />\n            </a-input>\n        </a-form-model-item>\n        <a-form-model-item prop=\"password\">\n            <a-input placeholder=\"密码\" style=\"width: 320px;\" type=\"password\" v-model=\"ruleForm.password\">\n                <a-icon slot=\"prefix\" type=\"lock\" style=\"color: rgba(0,0,0,.25)\" />\n            </a-input>\n        </a-form-model-item>\n        <a-form-model-item class=\"checkingBox\" prop=\"code\">\n            <!-- 验证码 -->\n            <div class=\"yzm\">\n                <a-input placeholder=\"验证码\" style=\"width: 220px;\" v-model=\"ruleForm.code\">\n                    <a-icon slot=\"prefix\" type=\"inbox\" style=\"color: rgba(0,0,0,.25)\" />\n                </a-input>\n                <!-- 验证码盒子 -->\n                <div class=\"captcha\">\n                    <a-spin :spinning=\"captcha.isLoading\">\n                        <img :src=\"captcha.img\" alt=\"\" @click=\"queryCaptcha\">\n                    </a-spin>\n                </div>\n            </div>\n        </a-form-model-item>\n        <!-- 记住密码 -->\n        <a-form-model-item prop=\"remeber\">\n            <a-checkbox>\n                记住密码\n            </a-checkbox>\n        </a-form-model-item>\n        <a-form-item class=\"login-form-last\">\n            <a-button type=\"primary\" class=\"login-form-button\" @click=\"submit\">\n                Log in\n            </a-button>\n        </a-form-item>\n    </a-form-model>\n</template>\n\n<style lang=\"less\" scoped>\n#container {\n    margin-top: -300px;\n\n    // text-align: center;\n    .login-form-last {\n        text-align: center;\n    }\n\n    .login-form-button {\n        text-align: center;\n        width: 80%;\n    }\n\n    .yzm {\n        display: flex;\n\n        .captcha {\n            height: 32px;\n            flex: 1;\n            text-align: center;\n            background: rgba(0, 0, 0, 0.05);\n            margin-left: 5px;\n\n            .ant-spin-container {\n                img {\n                    margin-top: -8px;\n                    width: 95px;\n                    height: 34px;\n                    cursor: pointer;\n                }\n            }\n\n            .ant-spin {\n                height: 80%;\n            }\n        }\n    }\n\n}\n</style>"],"mappings":";;AACA,OAAAA,EAAA;AACA,OAAAC,MAAA;AACA;EACAC,OAAA;IACA;IACA,MAAAC,aAAA;MACA,KAAAC,OAAA,CAAAC,SAAA;MACA;QACA;UAAAC,IAAA;UAAAC,GAAA;UAAAC;QAAA,eAAAC,IAAA,CAAAC,iBAAA;QACA,KAAAJ,IAAA;UACA,KAAAK,QAAA,CAAAC,KAAA;QACA;UACA,KAAAR,OAAA,CAAAG,GAAA,6BAAAA,GAAA;UACA,KAAAH,OAAA,CAAAI,IAAA,GAAAA,IAAA;QACA;MACA,SAAAK,GAAA;QACAC,OAAA,CAAAC,GAAA,CAAAF,GAAA;MACA;MACA,KAAAT,OAAA,CAAAC,SAAA;IACA;IACA;IACA,MAAAW,OAAA;MACA;QACA;QACA,WAAAC,KAAA,CAAAC,OAAA,CAAAC,QAAA;;QAEA;QACA;UAAAC,QAAA;UAAAC,QAAA;UAAAf,IAAA;UAAAgB;QAAA,SAAAC,QAAA;QACA;UAAAjB,IAAA,EAAAkB,UAAA;UAAAC,KAAA;UAAAC;QAAA,eAAAjB,IAAA,CAAAkB,cAAA;UACAP,QAAA;UACAC,QAAA;UACAf,IAAA;UACAE,IAAA,OAAAJ,OAAA,CAAAI;QACA;QACA;QACA,KAAAgB,UAAA;UACA,KAAAb,QAAA,CAAAC,KAAA,CAAAc,GAAA;UACA;QACA;QACA;QACA;QACA1B,EAAA,CAAA4B,OAAA,CAAAC,GAAA,OAAAJ,KAAA;QACA,WAAAK,MAAA,CAAAC,QAAA;QACA,IAAAT,OAAA;UACAtB,EAAA,CAAA4B,OAAA,CAAAC,GAAA;YACAT,QAAA;YACAC,QAAA;UACA;QACA;UACArB,EAAA,CAAA4B,OAAA,CAAAI,MAAA;QACA;QACA,KAAArB,QAAA,CAAAsB,OAAA;QACA,KAAAC,OAAA,CAAAC,IAAA;MACA,SAAAC,CAAA;QACAtB,OAAA,CAAAC,GAAA;UAAAqB;QAAA;MACA;IACA;EACA;EACA;EACAC,QAAA;IACA,KAAAlC,YAAA;EACA;EACAmC,KAAA;IACA;IACA,MAAAC,gBAAA,GAAAA,CAAAH,CAAA,EAAAI,KAAA,EAAAC,QAAA;MACA;MACA,IAAAD,KAAA,CAAAE,MAAA,eAAAD,QAAA,KAAAE,KAAA;MACA;AACA;MACAF,QAAA;IACA;IACA;MACArC,OAAA;QACAC,SAAA;QACAE,GAAA;QACAC,IAAA;MACA;MACAe,QAAA;QACAH,QAAA;QACAC,QAAA;QACAf,IAAA;QACAgB,OAAA;MACA;MACAsB,KAAA;QACAxB,QAAA,GACA;UACAyB,QAAA;UAAAC,OAAA;UAAAC,OAAA;QACA,EACA;QACA1B,QAAA,GACA;UACAwB,QAAA;UACAG,SAAA,EAAAT,gBAAA;UAAAQ,OAAA;QACA,EACA;QACAzC,IAAA,GACA;UACAuC,QAAA;UAAAC,OAAA;UAAAC,OAAA;QACA;MAEA;IAEA;EACA;AACA"},"metadata":{},"sourceType":"module","externalDependencies":[]}