import{d as e,r as t,A as a,s as o,a as l,_ as n,u as r,b as c,o as s,c as i,e as d,f as u,g as m,h as f,F as y,i as v,I as h,S as p}from"./index-7a41b293.js";const g=e("collect",(()=>{const e=t(null),n=async()=>{let t=null;try{let{code:o,data:l}=await a.storeList();0==+o&&(t=l,e.value=t)}catch(o){}return t};return{collectList:e,queryCollectList:n,removeCollectList:async t=>{if(null==e?void 0:e.value)try{let{code:n}=await a.storeRemove(t);if(0!=+n)return void o("移除失败");l("移除成功"),e.value=e.value.filter((e=>+e.id!=+t))}catch(n){}},insertCollectList:async e=>{try{let{code:t}=await a.storeAdd(e);if(0!=+t)return void o("收藏失败");await n(),l("收藏成功")}catch(t){}}}})),b=["innerHTML"],w={class:"nav-box"},C=n({__name:"Detail",setup(e){const{reactive:t,onBeforeMount:a,onUnmounted:o,nextTick:l,computed:n,router:C,route:L,API:x,showFailToast:k}=r(),q=c(),I=g(),S=L.params.id,_=t({info:null,extra:null});let j=null;const M=()=>{const e=document.querySelector(".img-place-holder");if(!e)return;const t=new Image;t.src=_.info.image,t.onload=()=>e.appendChild(t),t.onerror=()=>{const t=e.parentNode;t.parentNode.removeChild(t)}};a((async()=>{try{let e=await x.queryNewsInfo(S);_.info=Object.freeze(e),(()=>{var e,t;let a=null==(t=null==(e=_.info)?void 0:e.css)?void 0:t[0];a&&(j=document.createElement("link"),j.rel="stylesheet",j.href=a,document.head.appendChild(j))})(),l(M)}catch(e){}})),a((async()=>{try{let e=await x.queryStoryExtra(S);_.extra=Object.freeze(e)}catch(e){}})),o((()=>{j&&document.head.removeChild(j)})),a((()=>{q.profile&&!I.collectList&&I.queryCollectList()}));const T=n((()=>(I.collectList||[]).find((e=>String(e.news.id)===String(S))))),A=()=>{if(!q.profile)return k("请您先登录"),void C.replace({path:"/login",query:{target:L.fullPath}});T.value?I.removeCollectList(T.value.id):I.insertCollectList(S)};return(e,t)=>{const a=p,o=h;return s(),i(y,null,[d(_).info?(s(),i("div",{key:1,class:"contentMy",innerHTML:d(_).info.body},null,8,b)):(s(),u(a,{key:0,title:"",row:5})),m("div",w,[f(o,{name:"arrow-left",onClick:t[0]||(t[0]=e=>d(C).go(-1))}),d(_).extra?(s(),i(y,{key:0},[f(o,{name:"comment-o",badge:d(_).extra.comments},null,8,["badge"]),f(o,{name:"good-job-o",badge:d(_).extra.popularity},null,8,["badge"]),f(o,{name:"star-o",color:d(T)?"#1989fa":"",onClick:A},null,8,["color"]),f(o,{name:"share-o",color:"#ccc"})],64)):v("",!0)])],64)}}},[["__scopeId","data-v-9db5a17b"]]);export{C as default};
