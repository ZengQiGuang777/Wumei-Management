import{ap as e,aq as t,ao as a,aj as l,ar as r,j as n,af as o,n as s,G as i,ab as u,k as c,H as d,r as g,as as f,K as p,at as m,m as v,au as h,av as b,X as y,a6 as k,a3 as x,O as w,h as S,P as M,q as V,L as C,ai as I,aw as B,p as A,I as E,a7 as z,y as j,ax as P,w as T}from"./index-7a41b293.js";import{c as L,a as W}from"./index-699550bc.js";import{u as $}from"./use-id-1ac3f19f.js";function q(e){return Array.isArray(e)?!e.length:0!==e&&!e}function H(e,t){const{message:a}=t;return l(a)?a(e,t):a||""}function F({target:e}){e.composing=!0}function O({target:e}){e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}function R(e){return[...e].length}function D(e,t){return[...e].slice(0,t).join("")}const[K,G]=n("field");const X=T(c({name:K,props:o({},L,{id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:s,formatter:Function,clearIcon:i("clear"),modelValue:M(""),inputAlign:String,placeholder:String,autocomplete:String,autocapitalize:String,autocorrect:String,errorMessage:String,enterkeyhint:String,spellcheck:{type:Boolean,default:null},clearTrigger:i("focus"),formatTrigger:i("onChange"),error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null}},{rows:s,type:i("text"),rules:Array,autosize:[Boolean,Object],labelWidth:s,labelClass:u,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}}),emits:["blur","focus","clear","keypress","clickInput","endValidate","startValidate","clickLeftIcon","clickRightIcon","update:modelValue"],setup(l,{emit:n,slots:o}){const s=$(),i=d({status:"unvalidated",focused:!1,validateMessage:""}),u=g(),c=g(),M=g(),{parent:T}=f(V),L=()=>{var e;return String(null!=(e=l.modelValue)?e:"")},K=e=>C(l[e])?l[e]:T&&C(T.props[e])?T.props[e]:void 0,X=p((()=>{const e=K("readonly");if(l.clearable&&!e){const e=""!==L(),t="always"===l.clearTrigger||"focus"===l.clearTrigger&&i.focused;return e&&t}return!1})),J=p((()=>M.value&&o.input?M.value():l.modelValue)),N=e=>e.reduce(((e,t)=>e.then((()=>{if("failed"===i.status)return;let{value:e}=J;if(t.formatter&&(e=t.formatter(e,t)),!function(e,t){if(q(e)){if(t.required)return!1;if(!1===t.validateEmpty)return!0}return!(t.pattern&&!t.pattern.test(String(e)))}(e,t))return i.status="failed",void(i.validateMessage=H(e,t));if(t.validator){if(q(e)&&!1===t.validateEmpty)return;return function(e,t){return new Promise((l=>{const r=t.validator(e,t);a(r)?r.then(l):l(r)}))}(e,t).then((a=>{a&&"string"==typeof a?(i.status="failed",i.validateMessage=a):!1===a&&(i.status="failed",i.validateMessage=H(e,t))}))}}))),Promise.resolve()),Q=()=>{i.status="unvalidated",i.validateMessage=""},U=()=>n("endValidate",{status:i.status,message:i.validateMessage}),Y=(e=l.rules)=>new Promise((t=>{Q(),e?(n("startValidate"),N(e).then((()=>{"failed"===i.status?(t({name:l.name,message:i.validateMessage}),U()):(i.status="passed",t(),U())}))):t()})),Z=e=>{if(T&&l.rules){const{validateTrigger:t}=T.props,a=I(t).includes(e),r=l.rules.filter((t=>t.trigger?I(t.trigger).includes(e):a));r.length&&Y(r)}},_=(e,t="onChange")=>{const a=e;e=(e=>{var t;const{maxlength:a}=l;if(C(a)&&R(e)>+a){const l=L();if(l&&R(l)===+a)return l;const r=null==(t=u.value)?void 0:t.selectionEnd;if(i.focused&&r){const t=[...e],l=t.length-+a;return t.splice(r-l,l),t.join("")}return D(e,+a)}return e})(e);const r=R(a)-R(e);if("number"===l.type||"digit"===l.type){const t="number"===l.type;e=B(e,t,t)}let o=0;if(l.formatter&&t===l.formatTrigger){const{formatter:t,maxlength:r}=l;if(e=t(e),C(r)&&R(e)>+r&&(e=D(e,+r)),u.value&&i.focused){const{selectionEnd:e}=u.value,l=D(a,e);o=R(t(l))-R(l)}}if(u.value&&u.value.value!==e)if(i.focused){let{selectionStart:t,selectionEnd:a}=u.value;if(u.value.value=e,C(t)&&C(a)){const l=R(e);r?(t-=r,a-=r):o&&(t+=o,a+=o),u.value.setSelectionRange(Math.min(t,l),Math.min(a,l))}}else u.value.value=e;e!==l.modelValue&&n("update:modelValue",e)},ee=e=>{e.target.composing||_(e.target.value)},te=()=>{var e;return null==(e=u.value)?void 0:e.blur()},ae=()=>{var e;return null==(e=u.value)?void 0:e.focus()},le=()=>{const a=u.value;"textarea"===l.type&&l.autosize&&a&&function(a,l){const n=e();a.style.height="auto";let o=a.scrollHeight;if(r(l)){const{maxHeight:e,minHeight:t}=l;void 0!==e&&(o=Math.min(o,e)),void 0!==t&&(o=Math.max(o,t))}o&&(a.style.height=`${o}px`,t(n))}(a,l.autosize)},re=e=>{i.focused=!0,n("focus",e),k(le),K("readonly")&&te()},ne=e=>{i.focused=!1,_(L(),"onBlur"),n("blur",e),K("readonly")||(Z("onBlur"),k(le),P())},oe=e=>n("clickInput",e),se=e=>n("clickLeftIcon",e),ie=e=>n("clickRightIcon",e),ue=p((()=>"boolean"==typeof l.error?l.error:!(!T||!T.props.showError||"failed"!==i.status)||void 0)),ce=p((()=>{const e=K("labelWidth"),t=K("labelAlign");if(e&&"top"!==t)return{width:m(e)}})),de=e=>{if(13===e.keyCode){T&&T.props.submitOnEnter||"textarea"===l.type||A(e),"search"===l.type&&te()}n("keypress",e)},ge=()=>l.id||`${s}-input`,fe=()=>{const e=G("control",[K("inputAlign"),{error:ue.value,custom:!!o.input,"min-height":"textarea"===l.type&&!l.autosize}]);if(o.input)return S("div",{class:e,onClick:oe},[o.input()]);const t={id:ge(),ref:u,name:l.name,rows:void 0!==l.rows?+l.rows:void 0,class:e,disabled:K("disabled"),readonly:K("readonly"),autofocus:l.autofocus,placeholder:l.placeholder,autocomplete:l.autocomplete,autocapitalize:l.autocapitalize,autocorrect:l.autocorrect,enterkeyhint:l.enterkeyhint,spellcheck:l.spellcheck,"aria-labelledby":l.label?`${s}-label`:void 0,onBlur:ne,onFocus:re,onInput:ee,onClick:oe,onChange:O,onKeypress:de,onCompositionend:O,onCompositionstart:F};return"textarea"===l.type?S("textarea",t,null):S("input",z("number"===(a=l.type)?{type:"text",inputmode:"decimal"}:"digit"===a?{type:"tel",inputmode:"numeric"}:{type:a},t),null);var a},pe=()=>{const e=o["right-icon"];if(l.rightIcon||e)return S("div",{class:G("right-icon"),onClick:ie},[e?e():S(E,{name:l.rightIcon,classPrefix:l.iconPrefix},null)])},me=()=>{if(l.showWordLimit&&l.maxlength){const e=R(L());return S("div",{class:G("word-limit")},[S("span",{class:G("word-num")},[e]),j("/"),l.maxlength])}},ve=()=>{if(T&&!1===T.props.showErrorMessage)return;const e=l.errorMessage||i.validateMessage;if(e){const t=o["error-message"],a=K("errorMessageAlign");return S("div",{class:G("error-message",a)},[t?t({message:e}):e])}},he=()=>[S("div",{class:G("body")},[fe(),X.value&&S(E,{ref:c,name:l.clearIcon,class:G("clear")},null),pe(),o.button&&S("div",{class:G("button")},[o.button()])]),me(),ve()];return v({blur:te,focus:ae,validate:Y,formValue:J,resetValidation:Q,getValidationStatus:()=>i.status}),h(b,{customValue:M,resetValidation:Q,validateWithTrigger:Z}),y((()=>l.modelValue),(()=>{_(L()),Q(),Z("onChange"),k(le)})),x((()=>{_(L(),l.formatTrigger),k(le)})),w("touchstart",(e=>{A(e),n("update:modelValue",""),n("clear",e)}),{target:p((()=>{var e;return null==(e=c.value)?void 0:e.$el}))}),()=>{const e=K("disabled"),t=K("labelAlign"),a=(()=>{const e=o["left-icon"];if(l.leftIcon||e)return S("div",{class:G("left-icon"),onClick:se},[e?e():S(E,{name:l.leftIcon,classPrefix:l.iconPrefix},null)])})();return S(W,{size:l.size,class:G({error:ue.value,disabled:e,[`label-${t}`]:t}),center:l.center,border:l.border,isLink:l.isLink,clickable:l.clickable,titleStyle:ce.value,valueClass:G("value"),titleClass:[G("label",[t,{required:l.required}]),l.labelClass],arrowDirection:l.arrowDirection},{icon:a&&"top"!==t?()=>a:null,title:()=>{const e=(()=>{const e=K("labelWidth"),t=K("labelAlign"),a=K("colon")?":":"";return o.label?[o.label(),a]:l.label?S("label",{id:`${s}-label`,for:o.input?void 0:ge(),onClick:e=>{A(e),ae()},style:"top"===t&&e?{width:m(e)}:void 0},[l.label+a]):void 0})();return"top"===t?[a,e].filter(Boolean):e||[]},value:he,extra:o.extra})}}}));export{X as F};
