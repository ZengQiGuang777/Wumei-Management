import{j as e,k as a,W as o,n as t,H as i,J as l,r as s,K as n,X as r,O as c,h as u,Y as d,Z as m,p as v,R as p,$ as g,a0 as f,Q as h,a1 as w,a2 as b,m as x,a3 as y,a4 as z,a5 as P,a6 as R,a7 as C,a8 as S,a9 as I,t as j,aa as U,P as Z,ab as k,G as X,ac as Y,ad as F,I as O,T as V,ae as L,af as A,ag as B,ah as D,w as T,ai as H,aj as N,E as W,L as $,ak as _,al as E,am as M,an as q,ao as G,_ as J,o as K,c as Q,N as ee,g as ae,x as oe,F as te,V as ie,y as le}from"./index-7a41b293.js";import{C as se}from"./index-699550bc.js";import{F as ne}from"./index-3120b205.js";import"./use-id-1ac3f19f.js";const re=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),ce=e("image-preview")[1];var ue=a({props:{src:String,show:Boolean,active:Number,minZoom:o(t),maxZoom:o(t),rootWidth:o(Number),rootHeight:o(Number),disableZoom:Boolean},emits:["scale","close","longPress"],setup(e,{emit:a,slots:o}){const t=i({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,initializing:!1,imageRatio:0}),x=l(),y=s(),z=s(),P=s(!1),R=s(!1);let C=0;const S=n((()=>{const{scale:e,moveX:a,moveY:o,moving:i,zooming:l,initializing:s}=t,n={transitionDuration:l||i||s?"0s":".3s"};return(1!==e||R.value)&&(n.transform=`matrix(${e}, 0, 0, ${e}, ${a}, ${o})`),n})),I=n((()=>{if(t.imageRatio){const{rootWidth:a,rootHeight:o}=e,i=P.value?o/t.imageRatio:a;return Math.max(0,(t.scale*i-a)/2)}return 0})),j=n((()=>{if(t.imageRatio){const{rootWidth:a,rootHeight:o}=e,i=P.value?o:a*t.imageRatio;return Math.max(0,(t.scale*i-o)/2)}return 0})),U=(o,i)=>{var l;if((o=p(o,+e.minZoom,+e.maxZoom+1))!==t.scale){const s=o/t.scale;if(t.scale=o,i){const e=h(null==(l=y.value)?void 0:l.$el),a={x:.5*e.width,y:.5*e.height},o=t.moveX-(i.x-e.left-a.x)*(s-1),n=t.moveY-(i.y-e.top-a.y)*(s-1);t.moveX=p(o,-I.value,I.value),t.moveY=p(n,-j.value,j.value)}else t.moveX=0,t.moveY=R.value?C:0;a("scale",{scale:o,index:e.active})}},Z=()=>{U(1)};let k,X,Y,F,O,V,L,A,B=!1;const D=a=>{const{touches:o}=a;if(k=o.length,2===k&&e.disableZoom)return;const{offsetX:i}=x;x.start(a),X=t.moveX,Y=t.moveY,A=Date.now(),B=!1,t.moving=1===k&&(1!==t.scale||R.value),t.zooming=2===k&&!i.value,t.zooming&&(F=t.scale,O=re(o))},T=()=>{if(k>1)return;const{offsetX:e,offsetY:o}=x,i=Date.now()-A;e.value<w&&o.value<w&&(i<250?L?(clearTimeout(L),L=null,(()=>{const e=t.scale>1?1:2;U(e,2===e||R.value?{x:x.startX.value,y:x.startY.value}:void 0)})()):L=setTimeout((()=>{a("close"),L=null}),250):i>b&&a("longPress"))},H=a=>{let o=!1;if((t.moving||t.zooming)&&(o=!0,t.moving&&X===t.moveX&&Y===t.moveY&&(o=!1),!a.touches.length)){t.zooming&&(t.moveX=p(t.moveX,-I.value,I.value),t.moveY=p(t.moveY,-j.value,j.value),t.zooming=!1),t.moving=!1,X=0,Y=0,F=1,t.scale<1&&Z();const a=+e.maxZoom;t.scale>a&&U(a,V)}v(a,o),T(),x.reset()},N=()=>{const{rootWidth:a,rootHeight:o}=e,i=o/a,{imageRatio:l}=t;P.value=t.imageRatio>i&&l<2.6,R.value=t.imageRatio>i&&l>=2.6,R.value&&(C=(l*a-o)/2,t.moveY=C,t.initializing=!0,g((()=>{t.initializing=!1}))),Z()},W=e=>{const{naturalWidth:a,naturalHeight:o}=e.target;t.imageRatio=o/a,N()};return r((()=>e.active),Z),r((()=>e.show),(e=>{e||Z()})),r((()=>[e.rootWidth,e.rootHeight]),N),c("touchmove",(e=>{const{touches:a}=e;if(x.move(e),t.moving){const{deltaX:a,deltaY:o}=x,i=a.value+X,l=o.value+Y;if((i>I.value||i<-I.value)&&!B&&x.isHorizontal())return void(t.moving=!1);B=!0,v(e,!0),t.moveX=p(i,-I.value,I.value),t.moveY=p(l,-j.value,j.value)}if(t.zooming&&(v(e,!0),2===a.length)){const e=re(a),o=F*e/O;V=(e=>({x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}))(a),U(o,V)}}),{target:n((()=>{var e;return null==(e=z.value)?void 0:e.$el}))}),()=>{const a={loading:()=>u(f,{type:"spinner"},null)};return u(m,{ref:z,class:ce("swipe-item"),onTouchstartPassive:D,onTouchend:H,onTouchcancel:H},{default:()=>[o.image?u("div",{class:ce("image-wrap")},[o.image({src:e.src})]):u(d,{ref:y,src:e.src,fit:"contain",class:ce("image",{vertical:P.value}),style:S.value,onLoad:W},a)]})}}});const[de,me]=e("image-preview"),ve=["show","teleport","transition","overlayStyle","closeOnPopstate"];var pe=a({name:de,props:{show:Boolean,loop:j,images:U(),minZoom:Z(1/3),maxZoom:Z(3),overlay:j,closeable:Boolean,showIndex:j,className:k,closeIcon:X("clear"),transition:String,beforeClose:Function,overlayClass:k,overlayStyle:Object,swipeDuration:Z(300),startPosition:Z(0),showIndicators:Boolean,closeOnPopstate:j,closeIconPosition:X("top-right"),teleport:[String,Object]},emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:a,slots:o}){const t=s(),l=i({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),n=()=>{if(t.value){const e=h(t.value.$el);l.rootWidth=e.width,l.rootHeight=e.height,t.value.resize()}},c=e=>a("scale",e),d=e=>a("update:show",e),m=()=>{V(e.beforeClose,{args:[l.active],done:()=>d(!1)})},v=e=>{e!==l.active&&(l.active=e,a("change",e))},p=()=>{if(e.showIndex)return u("div",{class:me("index")},[o.index?o.index({index:l.active}):`${l.active+1} / ${e.images.length}`])},g=()=>{if(o.cover)return u("div",{class:me("cover")},[o.cover()])},f=()=>{l.disableZoom=!0},w=()=>{l.disableZoom=!1},b=()=>{if(e.closeable)return u(O,{role:"button",name:e.closeIcon,class:[me("close-icon",e.closeIconPosition),F],onClick:m},null)},j=()=>a("closed"),U=(e,a)=>{var o;return null==(o=t.value)?void 0:o.swipeTo(e,a)};return x({swipeTo:U}),y(n),r([z,P],n),r((()=>e.startPosition),(e=>v(+e))),r((()=>e.show),(o=>{const{images:t,startPosition:i}=e;o?(v(+i),R((()=>{n(),U(+i,{immediate:!0})}))):a("close",{index:l.active,url:t[l.active]})})),()=>u(I,C({class:[me(),e.className],overlayClass:[me("overlay"),e.overlayClass],onClosed:j,"onUpdate:show":d},S(e,ve)),{default:()=>[b(),u(Y,{ref:t,lazyRender:!0,loop:e.loop,class:me("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:v,onDragEnd:w,onDragStart:f},{default:()=>[e.images.map(((t,i)=>u(ue,{src:t,show:e.show,active:l.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:l.rootWidth,rootHeight:l.rootHeight,disableZoom:l.disableZoom,onScale:c,onClose:m,onLongPress:()=>a("longPress",{index:i})},{image:o.image})))]}),p(),g()]})}});let ge;const fe={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};const he=(e,a=0)=>{if(L)return ge||({instance:ge}=B({setup(){const{state:e,toggle:a}=D(),o=()=>{e.images=[]};return()=>u(pe,C(e,{onClosed:o,"onUpdate:show":a}),null)}})),e=Array.isArray(e)?{images:e,startPosition:a}:e,ge.open(A({},fe,e)),ge};T(pe);const[we,be,xe]=e("uploader");function ye(e,a){return new Promise((o=>{if("file"===a)return void o();const t=new FileReader;t.onload=e=>{o(e.target.result)},"dataUrl"===a?t.readAsDataURL(e):"text"===a&&t.readAsText(e)}))}function ze(e,a){return H(e).some((e=>!!e.file&&(N(a)?a(e.file):e.file.size>+a)))}const Pe=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg|avif)/i;function Re(e){return!!e.isImage||(e.file&&e.file.type?0===e.file.type.indexOf("image"):e.url?(a=e.url,Pe.test(a)):"string"==typeof e.content&&0===e.content.indexOf("data:image"));var a}var Ce=a({props:{name:t,item:o(Object),index:Number,imageFit:String,lazyLoad:Boolean,deletable:Boolean,reupload:Boolean,previewSize:[Number,String,Array],beforeDelete:Function},emits:["delete","preview","reupload"],setup(e,{emit:a,slots:o}){const t=()=>{const{status:a,message:o}=e.item;if("uploading"===a||"failed"===a){const e="failed"===a?u(O,{name:"close",class:be("mask-icon")},null):u(f,{class:be("loading")},null),t=$(o)&&""!==o;return u("div",{class:be("mask")},[e,t&&u("div",{class:be("mask-message")},[o])])}},i=o=>{const{name:t,item:i,index:l,beforeDelete:s}=e;o.stopPropagation(),V(s,{args:[i,{name:t,index:l}],done:()=>a("delete")})},l=()=>a("preview"),s=()=>a("reupload"),n=()=>{if(e.deletable&&"uploading"!==e.item.status){const e=o["preview-delete"];return u("div",{role:"button",class:be("preview-delete",{shadow:!e}),tabindex:0,"aria-label":xe("delete"),onClick:i},[e?e():u(O,{name:"cross",class:be("preview-delete-icon")},null)])}},r=()=>{if(o["preview-cover"]){const{index:a,item:t}=e;return u("div",{class:be("preview-cover")},[o["preview-cover"](A({index:a},t))])}},c=()=>{const{item:a,lazyLoad:o,imageFit:t,previewSize:i,reupload:n}=e;return Re(a)?u(d,{fit:t,src:a.objectUrl||a.content||a.url,class:be("preview-image"),width:Array.isArray(i)?i[0]:i,height:Array.isArray(i)?i[1]:i,lazyLoad:o,onClick:n?s:l},{default:r}):u("div",{class:be("file"),style:W(e.previewSize)},[u(O,{class:be("file-icon"),name:"description"},null),u("div",{class:[be("file-name"),"van-ellipsis"]},[a.file?a.file.name:a.url]),r()])};return()=>u("div",{class:be("preview")},[c(),t(),n()])}});const Se=T(a({name:we,props:{name:Z(""),accept:X("image/*"),capture:String,multiple:Boolean,disabled:Boolean,readonly:Boolean,lazyLoad:Boolean,maxCount:Z(1/0),imageFit:X("cover"),resultType:X("dataUrl"),uploadIcon:X("photograph"),uploadText:String,deletable:j,reupload:Boolean,afterRead:Function,showUpload:j,modelValue:U(),beforeRead:Function,beforeDelete:Function,previewSize:[Number,String,Array],previewImage:j,previewOptions:Object,previewFullImage:j,maxSize:{type:[Number,String,Function],default:1/0}},emits:["delete","oversize","clickUpload","closePreview","clickPreview","clickReupload","update:modelValue"],setup(e,{emit:a,slots:o}){const t=s(),l=[],n=s(-1),r=(a=e.modelValue.length)=>({name:e.name,index:a}),c=()=>{t.value&&(t.value.value="")},d=o=>{if(c(),ze(o,e.maxSize)){if(!Array.isArray(o))return void a("oversize",o,r());{const t=function(e,a){const o=[],t=[];return e.forEach((e=>{ze(e,a)?t.push(e):o.push(e)})),{valid:o,invalid:t}}(o,e.maxSize);if(o=t.valid,a("oversize",t.invalid,r()),!o.length)return}}if(o=i(o),n.value>-1){const t=[...e.modelValue];t.splice(n.value,1,o),a("update:modelValue",t),n.value=-1}else a("update:modelValue",[...e.modelValue,...H(o)]);e.afterRead&&e.afterRead(o,r())},m=a=>{const{maxCount:o,modelValue:t,resultType:i}=e;if(Array.isArray(a)){const e=+o-t.length;a.length>e&&(a=a.slice(0,e)),Promise.all(a.map((e=>ye(e,i)))).then((e=>{const o=a.map(((a,o)=>{const t={file:a,status:"",message:"",objectUrl:URL.createObjectURL(a)};return e[o]&&(t.content=e[o]),t}));d(o)}))}else ye(a,i).then((e=>{const o={file:a,status:"",message:"",objectUrl:URL.createObjectURL(a)};e&&(o.content=e),d(o)}))},v=a=>{const{files:o}=a.target;if(e.disabled||!o||!o.length)return;const t=1===o.length?o[0]:[].slice.call(o);if(e.beforeRead){const a=e.beforeRead(t,r());if(!a)return void c();if(G(a))return void a.then((e=>{m(e||t)})).catch(c)}m(t)};let p;const g=()=>a("closePreview"),f=(t,i)=>{const s=["imageFit","deletable","reupload","previewSize","beforeDelete"],c=A(S(e,s),S(t,s,!0));return u(Ce,C({item:t,index:i,onClick:()=>a(e.reupload?"clickReupload":"clickPreview",t,r(i)),onDelete:()=>((o,t)=>{const i=e.modelValue.slice(0);i.splice(t,1),a("update:modelValue",i),a("delete",o,r(t))})(t,i),onPreview:()=>(a=>{if(e.previewFullImage){const o=e.modelValue.filter(Re),t=o.map((e=>(e.objectUrl&&!e.url&&"failed"!==e.status&&(e.url=e.objectUrl,l.push(e.url)),e.url))).filter(Boolean);p=he(A({images:t,startPosition:o.indexOf(a),onClose:g},e.previewOptions))}})(t),onReupload:()=>(e=>{y(),n.value=e})(i)},S(e,["name","lazyLoad"]),c),S(o,["preview-cover","preview-delete"]))},h=()=>{if(e.previewImage)return e.modelValue.map(f)},w=e=>a("clickUpload",e),b=()=>{if(e.modelValue.length>=+e.maxCount&&!e.reupload)return;const a=e.modelValue.length>=+e.maxCount&&e.reupload,i=e.readonly?null:u("input",{ref:t,type:"file",class:be("input"),accept:e.accept,capture:e.capture,multiple:e.multiple&&-1===n.value,disabled:e.disabled,onChange:v},null);return o.default?M(u("div",{class:be("input-wrapper"),onClick:w},[o.default(),i]),[[q,!a]]):M(u("div",{class:be("upload",{readonly:e.readonly}),style:W(e.previewSize),onClick:w},[u(O,{name:e.uploadIcon,class:be("upload-icon")},null),e.uploadText&&u("span",{class:be("upload-text")},[e.uploadText]),i]),[[q,e.showUpload&&!a]])},y=()=>{t.value&&!e.disabled&&t.value.click()};return _((()=>{l.forEach((e=>URL.revokeObjectURL(e)))})),x({chooseFile:y,closeImagePreview:()=>{p&&p.close()}}),E((()=>e.modelValue)),()=>u("div",{class:be()},[u("div",{class:be("wrapper",{disabled:e.disabled})},[h(),b()])])}})),Ie={class:"form-box"},je={style:{margin:"20px 40px"}},Ue=J({__name:"Update",setup:e=>(e,a)=>{const o=ne,t=Se,i=se,l=ie;return K(),Q(te,null,[u(ee,{title:"修改个人信息"}),ae("div",Ie,[u(i,{inset:""},{default:oe((()=>[u(o,{label:"用户名","label-width":"60px"}),u(o,{label:"用户头像","label-width":"60px"},{input:oe((()=>[u(t,{"max-count":"1"})])),_:1})])),_:1}),ae("div",je,[u(l,{"loading-text":"处理中...",round:"",block:"",type:"primary"},{default:oe((()=>[le(" 修改信息 ")])),_:1})])])],64)}},[["__scopeId","data-v-54592c5c"]]);export{Ue as default};
